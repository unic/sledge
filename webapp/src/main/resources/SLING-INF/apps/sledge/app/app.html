<!doctype html>
<html>
<head data-sly-unwrap data-sly-include="head.html"></head>
<body>
<div class="container-fluid">
    <div class="page-header">
        <h1>Sledge - A Sling Application Manager</h1>
    </div>
    <h2>Application Packages</h2>
    <p>
        <a href="${resource.path}.upload.html" class="add-package-button btn btn-default" role="button">Add new application package</a>
    </p>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Available packages</h3>
        </div>
        <div class="panel-body">
            <div class="application-packages-list">
                <div>
                    <div class="row app-package-header show-grid">
                        <div class="col-md-3">Package name</div>
                        <div class="col-md-1">Package Type</div>
                        <div class="col-md-1">Status</div>
                        <div class="col-md-1">Environment</div>
                        <div class="col-md-2">Actions</div>
                    </div>
                </div>
                <div data-sly-list="${resource.listChildren}">
                    <div class="row app-package-item show-grid">
                        <div class="col-md-3 app-package-item-description">${item.name}<br/>
                            groupId=${item.valueMap.groupId}, artifactId=${item.valueMap.artifactId}, version=${item.valueMap.version}</div>
                        <div class="col-md-1">
                            <span>${item.valueMap.applicationPackageType}</span>
                        </div>
                        <div class="col-md-1">
                            <span class="label label-primary"
                                  data-sly-test="${item.valueMap.state == 'UPLOADED'}">${item.valueMap.state}</span>
                            <span class="label label-success"
                                  data-sly-test="${item.valueMap.state == 'INSTALLED'}">${item.valueMap.state}</span>
                            <span class="label label-info"
                                  data-sly-test="${item.valueMap.state == 'UNINSTALLED'}">${item.valueMap.state}</span>
                            <span class="label label-danger"
                                  data-sly-test="${item.valueMap.state == 'FAILED'}">${item.valueMap.state}, check error logs!</span>
                        </div>
                        <div class="col-md-1">
                            <span class="label label-info" data-sly-test="${item.valueMap.applicationPackageType == 'sledgepackage' && (item.valueMap.state == 'INSTALLED' || item.valueMap.state == 'FAILED')}">
                                ${item.valueMap.usedEnvironment}
                            </span>
                        </div>
                        <div class="col-md-2 app-package-item-actions">
                            <a href="/etc/sledge/packages/${item.name}.html" data-sly-test="${item.valueMap.applicationPackageType == 'sledgepackage' && item.valueMap.state != 'INSTALLED'}">
                                <button class="btn btn-primary btn-sm" type="submit">Install</button>
                            </a>
                            <form action="${item.path}.install.html" method="POST" data-sly-test="${item.valueMap.applicationPackageType == 'generic' && item.valueMap.state != 'INSTALLED'}">
                                <input type="hidden" name=":redirect" value="/etc/sledge/packages.html"/>
                                <button class="btn btn-primary btn-sm" type="submit">Install</button>
                            </form>
                            <form action="${item.path}.uninstall.html" method="POST" data-sly-test="${item.valueMap.state == 'INSTALLED' || item.valueMap.state == 'FAILED'}">
                                <input type="hidden" name=":redirect" value="/etc/sledge/packages.html"/>
                                <button class="btn btn-warning btn-sm" type="submit">Uninstall</button>
                            </form>
                            <form action="/etc/sledge/packages/${item.name}" method="POST"
                                  data-sly-test="${item.valueMap.state != 'INSTALLED'}">
                                <input type="hidden" name=":operation" value="delete">
                                <input type="hidden" name=":redirect" value="${resource.path}.html"/>
                                <button class="btn btn-danger btn-sm" type="submit">Remove</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div data-sly-unwrap data-sly-include="bodyEnd.html"></div>
</body>
</html>
